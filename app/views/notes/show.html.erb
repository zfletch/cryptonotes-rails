<% if @note %>
  <div class="row text-center">
    <h1><%= t(".title") %></h1>
  </div>

  <% if @note.view_count && @note.view_count == 1 %>
    <div class="row text-center">
      <h4><%= t(".delete1") %></h4>
    </div>
  <% end %>

  <% if @note.view_count && @note.view_count == 0 %>
    <div class="row text-center">
      <h4><%= t(".delete2") %></h4>
    </div>
  <% end %>

  <br>
  <div class="row">
    <input class="form-control" id="password" placeholder="<%= t(".key") %>">
  </div>
  <br>

  <div id="encryptedtext" style="display: none;">
      <%= @note.text %>
  </div>

  <div id="plaintext" class="row jumbotron lead"></div>

  <div class="row">
    <strong><%= t(".link") %> </strong>
    <%= link_to note_url(@note.uuid), note_path(@note.uuid) %><br>
  </div>

  <div class="row">
    <strong><%= t(".show_key") %> </strong>
    <span id="note-uuid">
      <%= @note.uuid %>
    </span>
  </div>
<% else %>
  <div class="row text-center">
    <h1><%= t(".no_note1") %></h1>
    <p class="lead">
    <%= t(".no_note2") %> <strong><%= params[:id] %></strong>.
    </p>
  </div>
<% end %>

<script>
(function () {

var encryptedtext = $("#encryptedtext");
var password = $("#password");
var plaintext = $("#plaintext");

var decrypt = function () {
  var text;
  var success = false;

  try {
    text = sjcl.decrypt(password.val(), encryptedtext.text());

    success = true;
  } catch (e) {
    plaintext.text('');
  }

  if (success) {
    plaintext.text(text);
  }
}

decrypt();
password.on("input", decrypt);

})();

</script>
